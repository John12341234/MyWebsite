var lastId, topMenuHeight = 90, menuItems = $("#section_nav").find("a"), scrollItems = menuItems.map(function () {
    var a = $($(this).attr("href"));
    if (a.length) {
        return a;
    }
});
menuItems.click(function (c) {
    var a = $(this).attr("href"), b = a === "#" ? 0 : $(a).offset().top - topMenuHeight + 1;
    $("html, body").stop().animate({scrollTop: b}, 1000, "easeInOutExpo");
    c.preventDefault();
});

// resize elements based on window size
$(window).resize(function () {
    if ($(window).height() >= 600) {
        $(".navbar-static").css({"height": 127});
        $(".home-link").css({"font-size": 40});
        $(".home-link").css({"letter-spacing": 6});
        $(".navbar-static .navbar-nav").css({"margin-top": 40});
        $(".navbar-static .navbar-nav li a").css({"font-size": 13});
        $(".navbar-header").css({"top": 40});
    } else if ($(window).height() >= 400) {
        $(".navbar-static").css({"height": 87});
        $(".home-link").css({"font-size": 30});
        $(".home-link").css({"letter-spacing": 3});
        $(".navbar-static .navbar-nav").css({"margin-top": 10});
        $(".navbar-static .navbar-nav li a").css({"font-size": 10});
        $(".navbar-header").css({"top": 20});
    } else {
        $(".navbar-static").css({"height": 73});
        $(".home-link").css({"font-size": 26});
        $(".home-link").css({"letter-spacing": 2});
        $(".navbar-static .navbar-nav").css({"margin-top": 0});
        $(".navbar-static .navbar-nav li a").css({"font-size": 9});
        $(".navbar-header").css({"top": 15});
    }

    $(".carousel-dmc .carousel-caption h2").css({"font-size": $(window).height()/1080 * 50});
    $(".carousel-dmc .carousel-caption p").css({"font-size": $(window).height()/1080 * 24});
    $(".carousel-dmc .carousel-caption h2").css({"font-size": $(window).width()/1920 * 50});
    $(".carousel-dmc .carousel-caption h2").css({"letter-spacing": $(window).width()/1920 * 8});
    $(".carousel-dmc .carousel-caption p").css({"font-size": $(window).width()/1920 * 24});
    $(".carousel-dmc .carousel-caption p").css({"padding-top": $(window).height()/1080 * 40});
    $(".carousel-dmc .carousel-caption p").css({"margin-top": $(window).height()/1080 * 30});
    $(".navbar-static .dropdown.open .dropdown-menu, .navbar-static .dropdown:hover .dropdown-menu, .navbar-static .dropdown:focus .dropdown-menu").css({"padding": $(window).width()/1920 * 15});
    $(".navbar-static .dropdown.open .dropdown-menu, .navbar-static .dropdown:hover .dropdown-menu, .navbar-static .dropdown:focus .dropdown-menu").css({"margin-left": $(window).height()/1080 * -110});
    $(".navbar-static .dropdown.open .dropdown-menu a, .navbar-static .dropdown:hover .dropdown-menu a, .navbar-static .dropdown:focus .dropdown-menu a").css({"padding-top": $(window).height()/1080 * 5});
    $(".navbar-static .dropdown.open .dropdown-menu a, .navbar-static .dropdown:hover .dropdown-menu a, .navbar-static .dropdown:focus .dropdown-menu a").css({"padding-bottom": $(window).height()/1080 * 5});
});
$(window).trigger("resize");

// run when the document loads
$(document).ready(function () {
    $(".filters a").click(function () {
        $(".filters a.current").removeClass("current");
        $(this).addClass("current");
        var g = $(this).data("filter").substr(7);
        if (g == "all") {
            $(".grid-item").animate({opacity: 1}, 300);
        } else {
            $(".grid-item").each(function () {
                if (!$(this).hasClass(g)) {
                    $(this).animate({opacity: 0.1}, 300);
                } else {
                    $(this).animate({opacity: 1}, 300);
                }
            });
        }
        return false;
    });
    var a = {};
    // setup tablet gesture controls
    $(".carousel-dmc").hammer(a).on("swipeleft dragleft", function (g) {
        $(this).carousel("next");
    }).on("swiperight dragright", function (g) {
        $(this).carousel("prev");
    });
    if ($("#section_nav").length > 0) {
        $("#section_nav a").tooltip();
    }
    // setup faq group
    $("#faq-group .collapse").each(function (g, i) {
        var i = $(i);
        var h = i.parent().find("h3");
        i.on("show.bs.collapse", function () {
            $("html, body").animate({scrollTop: h.offset().top - 90 - 40}, 1000, "easeInOutExpo", function () {
            });
            h.addClass("open");
        });
        i.on("hidden.bs.collapse", function () {
            h.removeClass("open");
        });
    });
    // run when window has changed
    jQuery(window).hashchange(function () {
        var h = location.hash;
        if (h != "" && h != "#!" && h != "#!/") {
            var g = h.replace("#!/", "");
            console.log(g);
        }
    });
    jQuery(window).hashchange();

    if ($(window).width() > 1200) {
        $(".parallax").each(function (g, i) {
            var h = $(i);
            h.scrollAnimate({
                startScroll: h.offset().top - $(window).height(),
                endScroll: h.offset().top + h.height(),
                cssProperty: "background-position-y",
                before: 0,
                after: -100
            });
        });
        $(".img-block").each(function (g, i) {
            var h = $(i);
            h.scrollAnimate({
                startScroll: h.offset().top - $(window).height(),
                endScroll: h.offset().top + h.height(),
                cssProperty: "background-position-y",
                before: 300,
                after: -300
            });
        });
    }
    $(".scroll-top").click(function (g) {
        $("body, html").animate({scrollTop: 0}, 1000, "easeInOutExpo");
        g.preventDefault();
    });
    $.fn.waypoint.defaults = {
        context: window,
        continuous: true,
        enabled: true,
        horizontal: false,
        offset: 0,
        triggerOnce: false
    };
    if ($(window).width() > 1) {
        $.fn.waypoint.defaults = {
            context: window,
            continuous: true,
            enabled: true,
            horizontal: false,
            offset: "80%",
            triggerOnce: false
        };
        $(".totop-wrapper").waypoint(function (g) {
            if (g == "down") {
                $("#section_nav").fadeOut();
            } else {
                $("#section_nav").fadeIn();
            }
        });
        // fade in/out control settings
        if (!$("html").hasClass("ie8") && !$("html").hasClass("ie9")) {
            $(".tofade,.toflip,.tofadel,.tofader").css("opacity", 0);
            $(".tofade").waypoint(function (g) {
                if (g == "down") {
                    $(this).removeClass("animated fadeOutDown").addClass("animated fadeInUp");
                } else {
                    $(this).removeClass("animated fadeInUp").addClass("animated fadeOutDown");
                }
            });
            $(".toflip").waypoint(function (g) {
                if (g == "down") {
                    $(this).removeClass("animated fadeOutDown").addClass("animated flipInY");
                } else {
                    $(this).removeClass("animated flipInY").addClass("animated fadeOutDown");
                }
            });
            $(".tofadel").waypoint(function (g) {
                if (g == "down") {
                    $(this).removeClass("animated fadeOutLeft").addClass("animated fadeInLeft");
                } else {
                    $(this).removeClass("animated fadeInLeft").addClass("animated fadeOutLeft");
                }
            });
            $(".tofader").waypoint(function (g) {
                if (g == "down") {
                    $(this).removeClass("animated fadeOutRight").addClass("animated fadeInRight");
                } else {
                    $(this).removeClass("animated fadeInRight").addClass("animated fadeOutRight");
                }
            });
        }
    }
    $(window).trigger("resize");
});